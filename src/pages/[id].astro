---
// src/pages/[id].astro
export const prerender = false;

// Importamos los componentes necesarios
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Beneficios from '../components/Beneficios.astro';
import Promociones from '../components/Promociones.astro';
import Juegos from '../components/Juegos.astro';
import Registro from '../components/Registro.astro';
import Soporte from '../components/Soporte.astro';
import Footer from '../components/Footer.astro';

// Importamos todos los Heroes disponibles
import Hero01 from '../heros/Hero(1).astro';
import Hero02 from '../heros/Hero(2).astro';
import Hero03 from '../heros/Hero(3).astro';
import Hero04 from '../heros/Hero(4).astro';
import Hero05 from '../heros/Hero(5).astro';
import Hero06 from '../heros/Hero(6).astro';
import Hero07 from '../heros/Hero(7).astro';
import Hero08 from '../heros/Hero(8).astro';
import Hero09 from '../heros/Hero(9).astro';
import Hero10 from '../heros/Hero(10).astro';
import Hero11 from '../heros/Hero(11).astro';
import Hero12 from '../heros/Hero(12).astro';
import Hero13 from '../heros/Hero(13).astro';
import Hero14 from '../heros/Hero(14).astro';
import Hero15 from '../heros/Hero(15).astro';
import Hero16 from '../heros/Hero(16).astro';
import Hero17 from '../heros/Hero(17).astro';
import Hero18 from '../heros/Hero(18).astro';
import Hero19 from '../heros/Hero(19).astro';
import Hero20 from '../heros/Hero(20).astro';
import Hero21 from '../heros/Hero(21).astro';
import Hero22 from '../heros/Hero(22).astro';
import Hero23 from '../heros/Hero(23).astro';
import Hero24 from '../heros/Hero(24).astro';

// Importamos la función para obtener el número de WhatsApp
import { getWhatsAppNumber } from '../data/auth';

// Obtener el parámetro de la URL
const { id } = Astro.params;

// Tipo de versión válida
type VersionId = '01' | '02' | '03' | '04' | '05' | '06' 
                | '07' | '08' | '09' | '10' | '11' | '12' | '13' |
                 '14' | '15' | '16' | '17' | '18' | '19' | '20' | '21' | '22' | '23' | '24';

// Comprobar si el ID es una versión válida
function isValidVersion(id: string | undefined): id is VersionId {
  return Boolean(
    id && ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10' , '11' ,
     '12' , '13' , '14' , '15' , '16' , '17' , '18' , '19' , '20' , '21' , '22', '23', '24'].includes(id)
  );
}

// Si el ID no es válido, redirigir a la versión predeterminada
if (!isValidVersion(id)) {
  return Astro.redirect('/01');
}

// Convertir ID a número de hero (01 -> 1, 02 -> 2, etc.)
const heroId = parseInt(id);

// Obtener el número de WhatsApp para este hero
let whatsappNumber = '';
try {
  whatsappNumber = await getWhatsAppNumber(heroId);
} catch (error) {
  console.error(`Error al obtener número para Hero ${heroId}:`, error);
  whatsappNumber = '5491123456789'; // Número por defecto
}

// Crear enlaces de WhatsApp
const whatsappText = 'Holaa%20quiero%20crear%20mi%20cuenta';
const whatsappLink = `https://wa.me/${whatsappNumber}?text=${whatsappText}`;

// Mapeo de componentes de Hero
const heroComponents = {
  '01': Hero01,
  '02': Hero02,
  '03': Hero03,
  '04': Hero04,
  '05': Hero05,
  '06': Hero06,
  '07': Hero07,
  '08': Hero08,
  '09': Hero09,
  '10': Hero10,
  '11': Hero11,
  '12': Hero12,
  '13': Hero13,
  '14': Hero14,
  '15': Hero15,
  '16': Hero16,
  '17': Hero17,
  '18': Hero18,
  '19': Hero19,
  '20': Hero20,
  '21': Hero21,
  '22': Hero22,
  '23': Hero23,
  '24': Hero24
};

// Configuración para cada versión
const versions = {
  '01': {
    hero: Hero01,
    pixelEvent: 'Lead01'
  },
  '02': {
    hero: Hero02,
    pixelEvent: 'Lead02'
  },
  '03': {
    hero: Hero03,
    pixelEvent: 'Lead03'
  },
  '04': {
    hero: Hero04,
    pixelEvent: 'Lead04'
  },
  '05': {
    hero: Hero05,
    pixelEvent: 'Lead05'
  },
  '06': {
    hero: Hero06,
    pixelEvent: 'Lead06'
  },
  '07': {
    hero: Hero07,
    pixelEvent: 'Lead07'
  },
  '08': {
    hero: Hero08,
    pixelEvent: 'Lead08'
  },
  '09': {
    hero: Hero09,
    pixelEvent: 'Lead09'
  },
  '10': {
    hero: Hero10,
    pixelEvent: 'Lead10'
  },
  '11': {
    hero: Hero11,
    pixelEvent: 'Lead11'
  },
  '12': {
    hero: Hero12,
    pixelEvent: 'Lead12'
  },
  '13': {
    hero: Hero13,
    pixelEvent: 'Lead13'
  },
  '14': {
    hero: Hero14,
    pixelEvent: 'Lead14'
  },
  '15': {
    hero: Hero15,
    pixelEvent: 'Lead15'
  },
  '16': {
    hero: Hero16,
    pixelEvent: 'Lead16'
  },
  '17': {
    hero: Hero17,
    pixelEvent: 'Lead17'
  },
  '18': {
    hero: Hero18,
    pixelEvent: 'Lead18'
  },
  '19': {
    hero: Hero19,
    pixelEvent: 'Lead19'
  },
  '20': {
    hero: Hero20,
    pixelEvent: 'Lead20'
  },
  '21': {
    hero: Hero21,
    pixelEvent: 'Lead21'
  },
  '22': {
    hero: Hero22,
    pixelEvent: 'Lead22'
  },
  '23': {
    hero: Hero23,
    pixelEvent: 'Lead23'
  },
  '24': {
    hero: Hero24,
    pixelEvent: 'Lead24'
  }
};

// Obtener la configuración para la versión actual
const version = versions[id];
const { hero: HeroComponent, pixelEvent } = version;

// Token de Facebook Pixel
const pixelToken = '1654651481848094';
---

<Layout title={`Las Vegas ${id} - Plataforma Premium`}>
  <!-- Facebook Pixel Code -->
  <script define:vars={{ pixelToken, pixelEvent }}>
    // Verificar si es un entorno de prueba
    function checkForTestMode() {
      // Buscar el parámetro fbpixel_test en la URL actual
      const params = new URLSearchParams(window.location.search);
      const testCode = params.get('fbpixel_test');
      return testCode === 'TEST8130';
    }

    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', pixelToken);

    // Activar modo de prueba si se detecta el parámetro
    if (checkForTestMode()) {
      fbq('set', 'autoConfig', false, pixelToken);
      console.log('Facebook Pixel Test Mode: TEST8130 activated');
    }
     
    fbq('track', pixelEvent);
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
    src={`https://www.facebook.com/tr?id=${pixelToken}&ev=${pixelEvent}&noscript=1`}
    />
  </noscript>
  <!-- End Facebook Pixel Code -->
  
  <!-- Manychat -->
  <script src="//widget.manychat.com/2686937_1c05d.js" defer="defer"></script>
  <script src="https://mccdn.me/assets/js/widget.js" defer="defer"></script>
  <!-- End Manychat -->

  <Navbar registrationLink={whatsappLink} />
  
  <!-- Renderiza el Hero específico para esta versión con el número de WhatsApp -->
  <HeroComponent 
    whatsappLink1={whatsappLink} 
    whatsappLink2={whatsappLink} 
    pixelEvent={pixelEvent}
  />
  
  <Beneficios />
  
  <Promociones registrationLink={whatsappLink} />
  
  <Juegos registrationLink={whatsappLink} />
  
  <Registro registrationLink={whatsappLink} />
  
  <Soporte whatsappLink1={whatsappLink} whatsappLink2={whatsappLink} />
  
  <Footer registrationLink={whatsappLink} whatsappLink1={whatsappLink} whatsappLink2={whatsappLink} />
</Layout>